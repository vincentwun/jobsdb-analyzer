<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analysis - JobsDB Analyzer</title>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <link rel="stylesheet" href="/index/index.css">
  <link rel="stylesheet" href="/setting/setting.css">
  <link rel="stylesheet" href="/analysis/analysis.css">
  <!-- Tailwind removed: using local CSS theme -->
</head>

<body>
  <div class="app">
    <aside class="sidebar" data-inject></aside>

    <main class="main">
      <section class="panel">
        <h2>AI Analysis</h2>
        <p style="color:var(--muted);margin-top:8px">Use Gemini AI to analyze job descriptions and extract skills,
          experience and qualifications</p>

        <!-- File Selection -->
        <div style="margin-top:24px">
          <div style="display:flex;gap:12px;align-items:center;margin-bottom:16px">
            <label style="font-weight:600;min-width:120px">Select source file:</label>
            <select id="fileSelector" style="flex:1;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:14px">
              <option value="">-- Loading... --</option>
            </select>
            <button id="loadFileBtn"
              style="padding:8px 16px;background:var(--accent);color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600">
              Load File
            </button>
          </div>

          <!-- File Info -->
          <div id="fileInfo"
            style="display:none;padding:12px;background:#f0fdf4;border:1px solid #86efac;border-radius:6px;margin-bottom:16px">
            <div style="font-size:13px;color:#166534">
              <strong>Loaded:</strong> <span id="currentFileName"></span>
            </div>
            <div style="font-size:13px;color:#166534;margin-top:4px">
              <strong>Jobs:</strong> <span id="jobCount"></span>
            </div>
          </div>
        </div>

        <!-- Analysis Controls -->
        <div style="margin-top:24px;padding:16px;background:#f9fafb;border-radius:8px;border:1px solid #e5e7eb">
          <h3 style="font-size:16px;font-weight:600;margin-bottom:12px">Analysis Options</h3>

          <div style="margin-bottom:12px">
            <label style="display:block;font-weight:500;margin-bottom:6px">Analysis prompt:</label>
            <textarea id="analysisPrompt" rows="4"
              style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:inherit;font-size:14px"
              placeholder="Please analyze these job descriptions, extract the most common skills, experience and qualifications. Group by category and provide counts.">Please analyze these job descriptions, extract the most common skills, experience and qualifications. Group by category and provide counts.</textarea>
          </div>

          <div style="display:flex;gap:12px">
            <button id="analyzeBtn" disabled class="btn-accent" style="flex:1;padding:12px;font-size:15px">ü§ñ Start AI
              Analysis</button>
            <button id="clearBtn" class="btn-muted" style="padding:12px 24px">Clear Results</button>
          </div>
        </div>

        <!-- Status -->
        <div id="statusArea" style="margin-top:16px;display:none">
          <div id="statusMessage" style="padding:12px;border-radius:6px;font-size:14px"></div>
        </div>

        <!-- Results -->
        <div id="resultsArea" style="margin-top:24px;display:none">
          <h3 style="font-size:18px;font-weight:700;margin-bottom:16px;color:#1f2937">Analysis Results</h3>
          <div id="resultsContent"
            style="padding:20px;background:white;border-radius:8px;border:1px solid #e5e7eb;white-space:pre-wrap;font-family:monospace;font-size:13px;line-height:1.6;max-height:600px;overflow-y:auto">
          </div>
        </div>

        <!-- Debug Info (collapsible) -->
        <details style="margin-top:24px">
          <summary style="cursor:pointer;font-weight:600;padding:8px;background:#f3f4f6;border-radius:6px">
            üîç Debug Info
          </summary>
          <div style="margin-top:12px;padding:16px;background:#fef3c7;border-radius:6px;border:1px solid #fbbf24">
            <div style="font-size:13px;margin-bottom:8px">
              <strong>Extracted items:</strong> <span id="debugExtractCount">0</span>
            </div>
            <div style="font-size:13px;margin-bottom:8px">
              <strong>Total chars:</strong> <span id="debugCharCount">0</span>
            </div>
            <div style="font-size:13px">
              <strong>API Key status:</strong> <span id="debugApiKeyStatus">Not set</span>
            </div>
          </div>
        </details>
      </section>
    </main>
  </div>

  <script src="/dist/app.js"></script>
  <script src="/dist/analysis.js"></script>
</body>

</html>